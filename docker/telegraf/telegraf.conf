# Telegraf Configuration for Neptune Apex (Python Script Parser)

[agent]
  interval = "${COLLECTION_INTERVAL}s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = "0s"
  hostname = "apex-telegraf"
  omit_hostname = false

# Output to InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]
  token = "${INFLUXDB_TOKEN}"
  organization = "${INFLUXDB_ORG}"
  bucket = "${INFLUXDB_BUCKET}"

# Execute Python script to fetch and parse Apex XML
[[inputs.exec]]
  commands = ["python3 /etc/telegraf/apex_xml_parser.py"]
  interval = "${COLLECTION_INTERVAL}s"
  timeout = "30s"
  data_format = "influx"

  ## Pass environment variables to the script
  [inputs.exec.tags]
    source = "neptune_apex"
