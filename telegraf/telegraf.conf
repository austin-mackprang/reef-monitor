# ---------- Telegraf agent ----------
[agent]
  interval = "10s"
  round_interval = true
  flush_interval = "10s"
  flush_jitter = "0s"
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  logfile = ""

# ---------- INPUT: Neptune Apex over HTTP ----------
[[inputs.http]]
  urls = ["http://192.168.1.59/cgi-bin/status.json"]   # <-- your Apex IP/host
  method = "GET"
  response_timeout = "30s"

  # Write under this measurement name (NOT "http")
  name_override = "apex"

  # Legacy JSON parser (robust)
  data_format = "json"

  # Only take the probes array from the payload
  json_query = "probes"

  # Keep only the numeric reading
  fieldpass = ["value"]

  # Promote these JSON keys to tags so we can filter in Grafana
  tag_keys = ["name","type"]   # e.g. name=Temp/pH/Salt/Level

  [inputs.http.headers]
    Accept = "application/json"
    User-Agent = "Telegraf"

# ---------- OUTPUT: InfluxDB v2 ----------
[[outputs.influxdb_v2]]
  urls = ["http://influxdb:8086"]      # if not using compose: http://localhost:8086
  token = "k8sXt2bh_hXDfx4Kzsk-4K0vqgW61wSUqoBTO8ruAJeZ_lN58e4o36D0saT_9mlCbp1Q1LZETmnpQ9TYKfFJvQ=="
  organization = "apex"
  bucket = "apex"

# ---- TEMP DEBUG OUTPUT (prints metrics to container logs) ----
[[outputs.file]]
  files = ["stdout"]
  data_format = "influx"